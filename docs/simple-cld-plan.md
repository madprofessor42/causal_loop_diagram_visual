# План: Базовое приложение Causal Loop Diagram (MVP)

## Цель
Создать простое приложение для рисования каузальных диаграмм с минимальной функциональностью:
- Создание переменных (круглые узлы)
- Соединение переменных стрелками
- Перемещение элементов по канвасу

## Технологический стек
- **React** + **TypeScript** + **Vite**
- **React Flow** (`@xyflow/react`) - для интерактивной диаграммы

## Основные компоненты

### 1. App.tsx (главный компонент)
- Содержит React Flow канвас
- Управляет состоянием узлов и связей
- Обрабатывает создание новых узлов
- Обрабатывает создание связей между узлами

### 2. CircleNode.tsx (компонент узла)
- Круглый узел с текстом внутри
- Редактируемая метка (по двойному клику)
- Порты для подключения связей

### 3. Sidebar.tsx (боковая панель)
- Кнопка для добавления новых переменных
- Или drag-and-drop элемент для создания узлов

## Структура данных

### Node (Узел)
```typescript
interface CLDNode {
  id: string;
  type: 'variable';
  position: { x: number; y: number };
  data: {
    label: string;
  };
}
```

### Edge (Связь)
```typescript
interface CLDEdge {
  id: string;
  source: string;
  target: string;
  type: 'default';
}
```

## Файловая структура
```
src/
├── App.tsx                 # Главный компонент с React Flow
├── App.css                 # Стили для App
├── components/
│   ├── CircleNode.tsx      # Компонент круглого узла
│   ├── CircleNode.css      # Стили для узла
│   └── Sidebar.tsx         # Боковая панель с инструментами
├── types/
│   └── node.ts             # TypeScript типы для узлов и связей
└── main.tsx                # Точка входа
```

## Этапы реализации

### Фаза 1: Базовая настройка React Flow
1. Настроить React Flow Provider
2. Создать пустой канвас с Background и Controls
3. Добавить базовое состояние для nodes и edges

### Фаза 2: Создание узлов
1. Реализовать компонент CircleNode
   - Круглая форма (CSS)
   - Отображение метки
   - Handles (порты) для подключения
2. Добавить возможность создания узлов:
   - Кнопка "Add Variable" в Sidebar
   - Или drag-and-drop с панели инструментов

### Фаза 3: Редактирование узлов
1. Двойной клик по узлу открывает режим редактирования
2. Инпут для изменения метки
3. Enter или blur сохраняет изменения

### Фаза 4: Создание связей
1. Подключить обработчик onConnect в React Flow
2. Создавать новые связи при соединении узлов
3. Базовая стрелка (используя встроенные стили React Flow)

### Фаза 5: Интерактивность
1. Перемещение узлов (уже работает в React Flow)
2. Удаление узлов (клавиша Delete)
3. Удаление связей (выделение + Delete)

## Минимальная функциональность (MVP)

### Обязательно:
- ✅ Создание переменных (круглые узлы)
- ✅ Редактирование имени переменной
- ✅ Соединение узлов стрелками
- ✅ Перемещение узлов по канвасу
- ✅ Удаление узлов и связей

### НЕ включаем в MVP:
- ❌ Полярность (+/-)
- ❌ Задержки (delays)
- ❌ Обнаружение петель
- ❌ Классификация петель
- ❌ Экспорт/импорт
- ❌ Контекстные меню
- ❌ Горячие клавиши (кроме Delete)

## Оценка времени
- Фаза 1: 5 минут
- Фаза 2: 10 минут
- Фаза 3: 5 минут
- Фаза 4: 5 минут
- Фаза 5: 5 минут

**Итого: ~30 минут на реализацию MVP**

## Следующие шаги (после MVP)
1. Добавить полярность связей (+/-)
2. Добавить индикатор задержки
3. Добавить обнаружение петель
4. Добавить экспорт/импорт

